<!-- TOC -->

- [基础](#基础)
- [文件操作](#文件操作)
- [移动光标](#移动光标)
    - [滚动](#滚动)
- [编辑](#编辑)
    - [多列编辑](#多列编辑)
        - [行首插入](#行首插入)
    - [整行移动](#整行移动)
    - [在行尾追加](#在行尾追加)
    - [复制粘贴](#复制粘贴)
    - [替换](#替换)
    - [剪切](#剪切)
    - [撤销](#撤销)
    - [重复上次命令](#重复上次命令)
    - [数字加1](#数字加1)
- [选择](#选择)
- [寄存器](#寄存器)
    - [复制再删除再粘贴](#复制再删除再粘贴)
    - [指定寄存器](#指定寄存器)
    - [系统粘贴板](#系统粘贴板)
- [搜索 search](#搜索-search)
- [命令行下用vim编辑](#命令行下用vim编辑)
- [匹配括号](#匹配括号)
- [设置](#设置)
    - [显示行号](#显示行号)
    - [不可见字符](#不可见字符)
- [排序](#排序)
- [终端](#终端)
    - [在终端中使用vim](#在终端中使用vim)
- [宏](#宏)
    - [示例: 在末尾加分号](#示例-在末尾加分号)
    - [示例: 从1到100,每行加1](#示例-从1到100每行加1)
- [参考](#参考)

<!-- /TOC -->


# 基础

* 自带教程 `vimtutor`
* `:version` 展示vim的所有相关信息

# 文件操作

* 打开文件 `vim [filename]`（文件名包含空格时在前面加上`\`）
* 写入文件 `:w`，写入并离开`:wq`
* 离开`:q`, `:q!`表示强制离开，不保存修改内容。
* 撤销所有改动回到最初的文件`:e!`

# 移动光标

* 上下左右 `k j h l`，在前面添加数字跳多个，比如`4h`
* 移动到行首`0`，移动到行尾`$`
* 移动到下一个单词或者标点符号`w`，移动到下一个单词忽略标点符号`W`，前面可加数字。
* 移动到上一个单词或者标点符号`b`，移动到下一个单词忽略标点符号`B`，前面可加数字。
* 移动到特定行`G`，比如最后一行`G`，第一行`1G`，第23行`23G`，也可以使用`:行号`
* 移动到单词尾 `e`
* `ta` 跳到下一个a前面一个字符, `Ta` 跳到前一个a后面一个字符上.
* `fa` 跳到下一个a上, `Fa` 跳到前一个a上.

## 滚动

- 向上滚动半屏 `ctrl + d`
- 向上滚动全屏 `ctrl + f`
- 向下滚动半屏 `ctrl + u`
- 向下滚动全屏 `ctrl + b`
- 向上滚动一行 `ctrl + e`
- 向下滚动一行 `ctrl + y`

# 编辑

* `i`表示插入，`a`表示添加，`c`表示更改，`d`表示删除，`y`表示复制，`p`表示粘贴。
* `a`与`i`都表示插入，`a`是在光标后插入，`i`是在光标前插入
* `c`与移动命令配合使用，比如`cw`修改后面的一个单词，如果光标在单词中间那就是半个单词，`c2b`修改前面2个单词，`c$`修改光标到结尾的字符，可使用大写`C`代替，`c0`修改光标到开头的字符，`cc`修改一整行
* 只覆盖一个字符`r`, 不进入编辑模式。`R`覆盖字符，最多覆盖一整行。
* `s`也可以只修改一个字符，但会进入编辑模式，而`2s`会修改光标及光标后一个字符共2个字符。`S`会替换整行内容，不管光标在哪，而`C`只能替换光标后的内容。

- 移动到行尾并编辑 `shift + a`
- 在当前位置下面创建一行并进入编辑模式 `o`
- 在当前位置上面创建一行并进入编辑模式 `O`
- 更改大小写`~`, `3~`
- 删除文本（`dw`删除单词，`dd或D`删除一行，`dw`会删到下一个单词为止，包括空格，不想删除空格就用`de`, `dE`包括标点在内的单词结尾），向前删除`db`，删到开头或结尾`d0或d$`, `D`删除光标到末尾的字符。
- 删除一个字符。删除光标所在字符`x`，删除光标前的字符`X`
- 删除到指定字符: `df<字符>`.



## 多列编辑

### 行首插入

1. 光标在第一行行首
2. 按 `ctrl + v`
3. 按 `shift + i`
4. 写入要添加的内容
5. 按 `escape` 两次


## 整行移动

- `>>` 光标所在行右移一个tab
- `<<` 光标所在行左移一个tab
- `n>>` 光标所在行后n行(包括当前行)右移一个tab
- `:m,n>` 从第m行到第n行右移一个tab
- `:m,n>>` 从第m行到第n行右移两个tab

## 在行尾追加

选中需要添加的行, 执行 `:normal A;` 将在行尾添加字符 `;`.

全文添加使用 `:%normal A;`.



## 复制粘贴

- 复制前面一个单词 `vby`(v进入可视化模式，b光标前一个单词，y复制)
- 复制当前行 `yy`
- 复制当前行及以后n行 `nyy`
- 粘贴到光标后面 `p`
- 粘贴到光标前面 `P`
- 当光标在行首时，按 `9v` 选择一行
- 粘贴时取消缩进: `:set paste`, 还原: `:set nopaste`.
- 复制到指定字符: `yf<字符>`(`yfo`从当前光标复制到o字符)


## 替换

- 替换光标下的一个字符 `r`
- 替换从光标开始的字符 `R`
- 替换当前行第一个匹配的 `:s/abc/def`
- 替换当前行所有匹配的 `:s/abc/def/g`
- 替换当前行到末尾每行第一个匹配的 `.,$s/abc/def`（每行所有匹配的加 `g`）
- 替换第n行到末尾每行第一个匹配的 `n,$s/abc/def` (每行所有匹配的加 `g`)
- 替换所有行第一个匹配的 `%s/abc/def`(每行所有匹配的加 `g`)
- 带确认替换，后面加c(confirm) `s/abc/def/gc`


## 剪切

- 剪切任意文本 `vd`(在可视化模式下,d表示剪切,y表示复制)
- 剪切一行 `dd`(`3dd` 剪切当前行及之后的行共3行)
- 剪切光标到行尾 `d$`
- 剪切光标到行首 `d^`
- 剪切光标前的单词 `db`
- 剪切光标后的单词 `dw`
- 剪切一个字符并进入编辑模式 `s`
- 剪切一个字符 `x`


## 撤销

`u`


## 重复上次命令
* `.` 重复上次执行的命令.

## 数字加1
* `ctrl+a` 将当前光标处的数字加1.如果当前光标处不是数字,向后查找直到行尾.



# 选择
* 从光标处到指定字符: `vf<字符>`.



# 寄存器
* 复制的内容只会被保存在寄存器"0. 
* 删除的内容被压到"1, 原来"1的内容压到"2, 以此类推, "9的内容会被删除. 
* 剪切的内容在 `"`.
* `"-` 短删除寄存器, 如 `d`, `d2h` 这种删除的内容不含换行符的话会被放到这个寄存器中.
* `".` 保存上次插入模式下的文字,比如i进入插入模式后写下的文字都保存在这里.
* 未命名寄存器 `"` 保存最近一次复制或删除操作内容，无论是否指定寄存器.
* 黑洞寄存器 `"_`, 如果删除的内容放到这里, 那么其他寄存器都不受影响, 粘贴时没法从这里粘贴.
* 查看所有寄存器 `:reg`, 在后面加上寄存器名称则可以查看其内容, 比如 `:reg 0`.

## 复制再删除再粘贴
问题: 复制时默认放到 `"` 和 `"0` 寄存器, 删除时会用删除的内容覆盖 `"` 寄存器, 粘贴时没法粘贴复制的内容.

* 先用 `y` 复制, 然后选中删除的内容执行 `"_d` 将其放到黑洞寄存器(或者删除单词 `"_dw`), 之后再用 `p` 粘贴回来.
* 复制删除照旧, 此时复制的内容在"0, 删除的内容在`"`, 粘贴时使用 `"0p`(指定寄存器粘贴).
* 先复制内容, 然后选中要删除的内容, 直接粘贴(`vwp`).

## 指定寄存器
* 在复制y或删除d命令前加上寄存器名称, 比如 `"c3yy` 将3行复制到寄存器"c中, 粘贴时使用 `"cp`.
* 寄存器的名称大小写都是同一个寄存器,只是行为不同, 大写的名称复制或删除时会追加到原来的内容之后, 比如 `"Cdd`, 粘贴时还是使用小写的.
* 在命令行中指定寄存器, 比如 `:2,4y a` 将2-4行复制到寄存器a中, `:'<,'>d A` 将选中内容删除并追加到寄存器a中. `:pu! a` 将寄存器a的内容粘贴到当前行之前.




## 系统粘贴板

在 `.vimrc` 中配置：

```
vmap "+y :w !pbcopy<CR><CR>
nmap "+p :r !pbpaste<CR><CR>
```

- 从vim复制到系统粘贴板: `"+y`
- 从系统粘贴板复制到vim: `"+p`



# 搜索 search

- 自光标位置向下搜索 `/pattern`
- 自光标位置向上搜索 `?pattern`
- 继续同方向搜索 `n`
- 继续反方向搜索 `N`
- 高亮显示搜索结果 `:set hlsearch`, 反之 `:set nohlsearch`, 高亮后取消高亮 `:noh`
- 大小写不敏感 `:set ignorecase`, 反之 `:set noignorecase`
- 如果搜索词全小写则大小写不敏感，如果有一个大写的则精确匹配 `:set noignorecase` + `:set smartcase`
- `?\Cword` 命令就只匹配单词word, `\c` 则执行忽略大小写的查询
- 搜索到末尾时不循环查找 `:set nowrapscan`, 反之 `:set wrapscan`
- 搜索光标所在单词，向下 `shift + *`, 向上 `shift + #`




# 命令行下用vim编辑

`ctrl+x, ctrl+e`



# 匹配括号

```basic
%
```



# 设置

## 显示行号

```
:set nu
```

## 不可见字符
* `:set invlist` 显示不可见字符.(^I表示tab, $表示回车)
* `:set nolist` 恢复默认模式.


# 排序

在可视模式下选中要排序的行, 输入 `:sort` 就可以进行排序了.


# 终端

## 在终端中使用vim

* `set -o vi` 进入 vi 编辑模式
* `set -o emacs` 进入 emacs 模式(默认)
* [可以使用的命令](http://www.catonmat.net/download/bash-vi-editing-mode-cheat-sheet.txt)


# 宏
* normal模式下输入 `qa` 开始录制宏, 命令被保存在寄存器a中, normal模式下输入 `q` 结束录制.
* `@a` 播放寄存器a中的宏, `3@a` 播放3次.

## 示例: 在末尾加分号
* `qf` 开始录制宏, 保存在寄存器 f 中.
* `$a;<ESC>j` 最后按 q 结束录制.
* `3@f` 播放宏.


## 示例: 从1到100,每行加1
* 在第一行输入1.
* `qmyyp<ctrl>aq` yyp 复制粘贴, `ctrl+a` 加1
* `98@m`



# 参考
* [Vim 复制粘贴探秘](http://www.cnblogs.com/jianyungsun/archive/2011/03/19/1988855.html)
* [vim寄存器使用详解](http://www.cnblogs.com/chenyadong/archive/2011/07/11/2103249.html)
* [Vim 寄存器](http://www.cnblogs.com/richardlee/articles/2479376.html)
* [每日一Vim（23）宏---Record、Play](http://liuzhijun.iteye.com/blog/1844845)